<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabrakan Galaxy dan Black Hole</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 100;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
    </style>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00f5ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js');
      });
    }
  </script>
</head>
<body>
    <div id="info">
        <strong>Simulasi Tabrakan Galaxy & Black Hole</strong><br>
        <span id="phase">Fase: Pendekatan</span><br>
        <span id="distance">Jarak: Menghitung...</span>
    </div>
    
    <div id="controls">
        <button onclick="resetSimulation()">Reset</button>
        <button onclick="toggleSpeed()">Kecepatan: <span id="speedText">Normal</span></button>
        <button onclick="togglePause()"><span id="pauseText">Pause</span></button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let galaxy, blackHole, accretionDisk, stars = [];
        let time = 0;
        let collisionStarted = false;
        let speed = 1;
        let paused = false;
        let particles = [];

        function init() {
            // Setup scene
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0008);

            // Setup camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 100, 300);
            camera.lookAt(0, 0, 0);

            // Setup renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Pencahayaan
            const ambientLight = new THREE.AmbientLight(0x222222);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1, 1000);
            pointLight.position.set(0, 0, 0);
            scene.add(pointLight);

            // Buat background stars
            createBackgroundStars();

            // Buat galaxy
            createGalaxy();

            // Buat black hole
            createBlackHole();

            // Window resize handler
            window.addEventListener('resize', onWindowResize, false);
        }

        function createBackgroundStars() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1,
                transparent: true,
                opacity: 0.8
            });

            const starsVertices = [];
            for (let i = 0; i < 3000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        function createGalaxy() {
            galaxy = new THREE.Group();
            
            // Core galaksi
            const coreGeometry = new THREE.SphereGeometry(5, 32, 32);
            const coreMaterial = new THREE.MeshBasicMaterial({
                color: 0xffdd88,
                transparent: true,
                opacity: 0.9
            });
            const core = new THREE.Mesh(coreGeometry, coreMaterial);
            galaxy.add(core);

            // Glow effect untuk core
            const glowGeometry = new THREE.SphereGeometry(8, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xffaa44,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            galaxy.add(glow);

            // Spiral arms dengan bintang-bintang
            for (let i = 0; i < 2000; i++) {
                const angle = (i / 2000) * Math.PI * 6;
                const radius = (i / 2000) * 80 + 10;
                const spiral = angle * 0.5;
                
                const x = Math.cos(angle + spiral) * radius;
                const z = Math.sin(angle + spiral) * radius;
                const y = (Math.random() - 0.5) * 10;

                const starGeometry = new THREE.SphereGeometry(0.3, 8, 8);
                const hue = 0.1 + Math.random() * 0.2;
                const starMaterial = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(hue, 1, 0.7)
                });
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(x, y, z);
                galaxy.add(star);
                stars.push({ mesh: star, originalPos: { x, y, z } });
            }

            galaxy.position.set(200, 0, 0);
            scene.add(galaxy);
        }

        function createBlackHole() {
            blackHole = new THREE.Group();

            // Event horizon (hitam sempurna)
            const bhGeometry = new THREE.SphereGeometry(10, 32, 32);
            const bhMaterial = new THREE.MeshBasicMaterial({
                color: 0x000000
            });
            const bhMesh = new THREE.Mesh(bhGeometry, bhMaterial);
            blackHole.add(bhMesh);

            // Accretion disk
            accretionDisk = new THREE.Group();
            
            for (let i = 0; i < 500; i++) {
                const angle = (i / 500) * Math.PI * 2;
                const radius = 15 + Math.random() * 25;
                
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                const y = (Math.random() - 0.5) * 3;

                const particleGeometry = new THREE.SphereGeometry(0.5, 8, 8);
                const temp = 1 - (radius - 15) / 25;
                const particleMaterial = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(0.05 + temp * 0.1, 1, 0.5 + temp * 0.3)
                });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                particle.position.set(x, y, z);
                accretionDisk.add(particle);
            }

            blackHole.add(accretionDisk);
            blackHole.position.set(-200, 0, 0);
            scene.add(blackHole);
        }

        function createParticleStream(startPos) {
            const geometry = new THREE.SphereGeometry(0.8, 8, 8);
            const material = new THREE.MeshBasicMaterial({
                color: new THREE.Color().setHSL(Math.random() * 0.2, 1, 0.6),
                transparent: true,
                opacity: 1
            });
            const particle = new THREE.Mesh(geometry, material);
            particle.position.copy(startPos);
            
            const direction = new THREE.Vector3()
                .subVectors(blackHole.position, startPos)
                .normalize();
            
            particles.push({
                mesh: particle,
                velocity: direction.multiplyScalar(2),
                life: 1.0
            });
            
            scene.add(particle);
        }

        function updatePhase() {
            const distance = galaxy.position.distanceTo(blackHole.position);
            document.getElementById('distance').textContent = `Jarak: ${distance.toFixed(1)} unit`;

            if (distance > 150) {
                document.getElementById('phase').textContent = 'Fase: Pendekatan';
            } else if (distance > 80) {
                document.getElementById('phase').textContent = 'Fase: Gravitasi Meningkat';
            } else if (distance > 40) {
                document.getElementById('phase').textContent = 'Fase: Deformasi Galaxy';
            } else if (distance > 20) {
                document.getElementById('phase').textContent = 'Fase: Tabrakan Aktif!';
            } else {
                document.getElementById('phase').textContent = 'Fase: Konsumsi Materi';
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            if (!paused) {
                time += 0.01 * speed;

                // Rotasi galaksi
                galaxy.rotation.y += 0.002 * speed;
                
                // Rotasi accretion disk lebih cepat
                accretionDisk.rotation.y += 0.05 * speed;

                // Gerakan galaksi mendekati black hole
                const distance = galaxy.position.distanceTo(blackHole.position);
                
                if (distance > 15) {
                    const direction = new THREE.Vector3()
                        .subVectors(blackHole.position, galaxy.position)
                        .normalize();
                    
                    const acceleration = 100 / (distance * distance);
                    galaxy.position.add(direction.multiplyScalar(acceleration * speed * 0.1));
                }

                // Efek gravitasi pada bintang-bintang
                if (distance < 150) {
                    stars.forEach((star, index) => {
                        const worldPos = new THREE.Vector3();
                        star.mesh.getWorldPosition(worldPos);
                        const distToBH = worldPos.distanceTo(blackHole.position);
                        
                        if (distToBH < 100) {
                            const pull = new THREE.Vector3()
                                .subVectors(blackHole.position, worldPos)
                                .normalize()
                                .multiplyScalar(50 / (distToBH * distToBH) * speed * 0.1);
                            
                            star.mesh.position.add(pull);

                            // Buat particle stream
                            if (Math.random() < 0.02 && distToBH < 60) {
                                createParticleStream(worldPos);
                            }

                            // Hapus bintang yang terlalu dekat
                            if (distToBH < 15) {
                                star.mesh.visible = false;
                            }
                        }
                    });
                }

                // Update particles
                particles.forEach((particle, index) => {
                    particle.mesh.position.add(particle.velocity.clone().multiplyScalar(speed));
                    particle.life -= 0.01 * speed;
                    particle.mesh.material.opacity = particle.life;
                    
                    const distToBH = particle.mesh.position.distanceTo(blackHole.position);
                    if (distToBH < 15 || particle.life <= 0) {
                        scene.remove(particle.mesh);
                        particles.splice(index, 1);
                    }
                });

                // Kamera orbit
                camera.position.x = Math.cos(time * 0.1) * 300;
                camera.position.z = Math.sin(time * 0.1) * 300;
                camera.lookAt(0, 0, 0);

                updatePhase();
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function resetSimulation() {
            // Reset posisi galaksi
            galaxy.position.set(200, 0, 0);
            galaxy.rotation.set(0, 0, 0);
            
            // Reset bintang-bintang
            stars.forEach(star => {
                star.mesh.position.set(star.originalPos.x, star.originalPos.y, star.originalPos.z);
                star.mesh.visible = true;
            });

            // Hapus semua particles
            particles.forEach(particle => {
                scene.remove(particle.mesh);
            });
            particles = [];

            time = 0;
            collisionStarted = false;
        }

        function toggleSpeed() {
            speed = speed === 1 ? 2 : speed === 2 ? 0.5 : 1;
            document.getElementById('speedText').textContent = 
                speed === 1 ? 'Normal' : speed === 2 ? 'Cepat' : 'Lambat';
        }

        function togglePause() {
            paused = !paused;
            document.getElementById('pauseText').textContent = paused ? 'Resume' : 'Pause';
        }

        init();
        animate();
    </script>
</body>
</html>